{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">
    <div class="row">
        <div class="col-xs-1"></div>
        <div class="col-xs-5">
            <p>
                <a href="/{{ glitz_details[2] }}">
                    <h4>{{ glitz_details[3] }}'s Glitz!</h4>
                </a>
            </p>
        </div>
        <div class="col-xs-2">
            <div class="resetButton" style="display: none" id="resetButton" onclick="resetGridCells()">Reset
            </div>
        </div>
    </div>

    <div class="row border" >
        <div class="col-xs-1 border"></div>
        <div class="col-xs-6 bigImageBackground">
            <div onmouseover="showGrid();" id="glitzContainer" class="container-fluid bg-overlay nopadding" style="background-image: url('../{{ glitz_details[0] }}');">

                {% for i in range(4) %}
                <div  class="row glitz_image_grid_row nopadding">

                    {% for j in range(4) %}
                        <div class="col-xs-3 nopadding glitz_image_grid_col">
                            <!-- <div class="overlay nopadding">%</div> -->
                            <div class="gridDetails noopGridCell" id="counter" onclick="handleGridClick(this)">
                                {{ i }}{{ j }}
                            </div>
                        </div>   
                    {% endfor %}    

                </div>
                {% endfor %}
            </div>
            <!-- <img src="../{{ glitz_details[0] }}" > -->
        </div>
        <div class="col-xs-4 bigCommentsBackground">
            <div class="">
                <div class="row">
                    <div class="col-xs-2 nopadding">
                        <div class="text-center">
                            <br/>
                            <img src="https://scontent-sjc3-1.xx.fbcdn.net/v/t1.0-9/22405720_10154699510411829_1712623705371794204_n.jpg?oh=de704a6ea3758e2c7287e0271df2a60f&oe=5B4AB7AB" class="comments-profile-userpic text-center" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
                        </div><!-- /thumbnail -->
                    </div><!-- /col-sm-1 -->    

                    <div class="col-xs-10">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <form action="/save_comment" id= "saveCommentForm" method="POST">
                                    <input type="hidden" name="glitz_id" value="{{ glitz_details[1] }}">
                                    <input type="hidden" id="selectedGridId" name="select_grids" value="02">
                                    <textarea class="commentTextArea" rows="2" cols="30" id="commentTextArea" name="comment"></textarea>
                                    <!-- <select name='select_grids'>
                                        {% for grid in grids %}
                                        <option value="{{ grid.grid_id }}">{{ grid.grid_name }}</option>
                                        {% endfor %}
                                    </select> -->
                                    <input type="button" id="saveCommentButton" class="form-control btn btn-login" value="Comment" style="width: 100px; padding: 5px">
                                </form>
                            </div><!-- /panel-body -->
                        </div><!-- /panel panel-default -->
                    </div><!-- /col-sm-5 -->
                </div><!-- /row -->


                {% for comment in glitz_comments %}
                <div class="commentRowForGridId{{ comment[4] }} noopCommentRow">
                    <div class="col-xs-2 nopadding">
                        <div class="text-center">
                            <img class="comments-profile-userpic text-center" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
                        </div><!-- /thumbnail -->
                    </div><!-- /col-sm-1 -->    

                    <div class="col-xs-10">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <strong>{{ comment[2] }}</strong> <span class="text-muted">commented 5 days ago</span>
                            </div>
                            <div class="panel-body">
                                {{ comment[0] }} 
                            </div><!-- /panel-body -->
                        </div><!-- /panel panel-default -->
                    </div><!-- /col-sm-5 -->
                </div><!-- /row -->
                {% endfor %}
            </div><!-- /container -->
        </div>
        <div class="col-xs-1 border"></div>
    </div>
</div>


<!-- glitz_details: path, glitz_id, user_id, name, grid_id -->

<!-- <link rel="stylesheet" href="../glitz/bootstrap-styles.css"> -->
<link rel="stylesheet" href="../glitz/glitz.css">
<script src="../glitz/glitz.js" type="text/javascript"></script>

<script type="text/javascript">

    var globalGridId = 2;


    $("#saveCommentButton").click(function(){
        // Invoke
        $("#selectedGridId").val(globalGridId);
        saveComment();
    }); 


    function showGrid() {
        // Except this cell, make others darkened 
        $(".noopGridCell").addClass("overlay");
        $(".noopGridCell").removeClass("gridDetails");
    }

    function handleGridClick(gridCell) {
        // $("#resetButton").show();
        var gridTextToGridIdMap = {
            "00": 1,
            "01": 2,
            "02": 3,
            "03": 4,
            "10": 5,
            "11": 6,
            "12": 7,
            "13": 8,
            "20": 9,
            "21": 10,
            "22": 11,
            "23": 12,
            "30": 13,
            "31": 14,
            "32": 15,
            "33": 16
        };

        // Except this cell, make others darkened 
        $(".noopGridCell").addClass("overlay");
        $(".noopGridCell").removeClass("gridDetails");
        $(".noopGridCell").removeClass("selectedGridOverlay");

        $(gridCell).removeClass("overlay");
        $(gridCell).addClass("gridDetails");
        $(gridCell).addClass("selectedGridOverlay");

        var gridText = $(gridCell).text();
        globalGridId = gridTextToGridIdMap[gridText.trim()];

        // Hide comments
        $(".noopCommentRow").hide();
        $(".commentRowForGridId" + globalGridId).show();

    }

    // Make all cells normal 
    function resetGridCells() {
        $(".noopGridCell").addClass("gridDetails");
        $(".noopGridCell").removeClass("overlay");

        $("#resetButton").hide();
    }

</script>



{% endblock %}